{"ts":1385062771076,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1385062824653,"patch":[[{"diffs":[[1,"var fs = require('fs'),\n    path = require('path'),\n    rimraf = require('rimraf'),\n    spawn = require('child_process').spawn;\n    \n    "]],"start1":0,"start2":0,"length1":0,"length2":137}]],"length":137,"saved":false}
{"ts":1385063000638,"patch":[[{"diffs":[[0,"var "],[-1,"fs"],[1,"path"],[0," = requi"]],"start1":0,"start2":0,"length1":14,"length2":16},{"diffs":[[0,"re('"],[-1,"fs"],[1,"path"],[0,"'),\n    "],[1,"s"],[0,"pa"],[-1,"th"],[1,"wn"],[0," = r"]],"start1":16,"start2":16,"length1":22,"length2":25},{"diffs":[[0,"re('"],[-1,"path'),\n    rimraf = require('rimraf'),\n    spawn = require('child_process').spawn"],[1,"child_process').spawn;\n\nvar respondInvalidWorkspace = function(res) {\n  res.status(400);\n  res.json({msg: \"Invalid workspace name\"});\n};\nvar createWorkspaceKillTimeout = function(workspaceProcess, workspaceName) {\n  var timeout = setTimeout(function() {\n    process.kill(-workspaceProcess.pid, 'SIGTERM');\n    console.info(\"Killed workspace \" + workspaceName);\n   }, 900000); //Workspaces have a lifetime of 15 minutes\n\n   return timeout;\n};\n/*\n* GET run a workspace\n*/\n exports.run = function(req, res) {\n  var potentiallyBadPathName = req.params.name.split(path.sep);\n  var workspaceName = potentiallyBadPathName[potentiallyBadPathName.length-1];\n\n  if(workspaceName === '..') {\n    respondInvalidWorkspace(res);\n    return;\n  }\n\n   console.log(\"Starting \" + __dirname + '/../../c9/bin/cloud9.sh for workspace ' + workspaceName + \" on port \" + req.nextFreePort);\n\n   var workspace = spawn(__dirname + '/../../c9/bin/cloud9.sh', ['-w', __dirname + '/../workspaces/' + req.user + '/' + workspaceName, '-l', '0.0.0.0', '-p', req.nextFreePort], {detached: true});\n   workspace.stderr.on('data', function (data) {\n     console.log('stdERR: ' + data);\n   });\n\n   req.app.get('runningWorkspaces')[req.user + '/' + workspaceName] = {\n     killTimeout: createWorkspaceKillTimeout(workspace, workspaceName),\n     process: workspace,\n     name: workspaceName\n   }"],[0,";\n"],[1,"\n"],[0,"   "],[-1," \n    "],[1,"res.json({msg: \"Successfully started workspace\", url: req.app.settings.baseUrl + \":\" + req.nextFreePort});\n }\n\n/*\n* POST to keep the workspace alive\n*/\n exports.keepAlive = function(req, res) {\n   var workspace = req.app.get('runningWorkspaces')[req.user + '/' + req.params.name];\n   clearTimeout(workspace.killTimeout);\n   workspace.killTimeout = createWorkspaceKillTimeout(workspace.process, workspace.name);\n   res.send();\n }"]],"start1":45,"start2":45,"length1":97,"length2":1792}]],"length":1837,"saved":false}
